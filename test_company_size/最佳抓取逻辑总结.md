# 公司规模抓取最佳逻辑总结

## 测试结果
- **成功率**: 100% (20/20)
- **测试数据**: outputs/test008/report_stage2_detail.xlsx 中的20个公司

## 最佳抓取逻辑

### 1. 从职位详情页提取公司URL
- 访问职位详情页
- 查找包含 `/company/` 的链接
- **关键优化**: 标准化URL，将不同国家的LinkedIn URL（如 `de.linkedin.com`, `in.linkedin.com`, `uk.linkedin.com`）统一转换为 `www.linkedin.com`
- 移除查询参数（如 `?trk=...`）

### 2. 访问公司页面，按优先级查找员工数

#### 优先级1: JSON-LD结构化数据（最快最准确）
```python
# 查找 <script type="application/ld+json">
# 提取 @type == 'Organization' 中的 numberOfEmployees.value
```

#### 优先级2: 标准dd标签
```python
# 查找 <dd class="org-about-company-module__company-size-definition-text">
```

#### 优先级3: 所有包含'employees'的元素
```python
# 遍历所有 span, div, p, li, a, dt, dd 元素
# 查找文本中包含数字和'employee'的元素
```

#### 优先级4: 字符串节点搜索
```python
# 查找包含'employees'的字符串节点，获取其父元素
```

### 3. 提取纯数字
- 使用正则表达式: `r'(\d{1,2}(?:,\d{3})+|\d{1,3})\s*employees?'`
- 移除逗号和点号
- **关键验证**: 排除年份范围（2020-2030）
- 验证数字范围（1-1000000）

### 4. 缓存机制
- 使用JSON文件缓存已获取的公司规模
- 避免重复请求，节省API调用
- 缓存键: `{公司名称}_final`

## 关键优化点

1. **URL标准化**: 解决了不同国家LinkedIn URL的问题（de.linkedin.com, in.linkedin.com等）
2. **多层级搜索**: 从结构化数据到HTML元素，确保最大覆盖率
3. **数字验证**: 排除年份等误匹配
4. **缓存优化**: 减少API调用，提高效率

## 测试文件位置
- 测试脚本: `test_company_size/test_final_method.py`
- 测试结果: `test_company_size/test_final_result.xlsx`
- 缓存文件: `test_company_size/test_cache.json`

