# 本地数据分析报告使用说明

## 脚本功能分析

### `generate_supabase_report.py` 原脚本作用

原脚本 `generate_supabase_report.py` 的主要功能：

1. **数据源**：从 Supabase 数据库读取工作数据
2. **分析维度**：
   - 数据完整性分析（各字段的填充率）
   - 薪资水平分析（均值、中位数、分位数等）
   - 时间范围分析（最早/最晚发布日期、时间跨度）
   - 地理位置分布（热门城市）
   - 平台分布（Indeed vs LinkedIn）
   - 跨地区对比分析
3. **输出**：生成包含统计图表和详细分析的 Word 报告

### `generate_local_report.py` 新脚本功能

新脚本 `generate_local_report.py` 实现了相同的分析功能，但数据源改为本地 Excel 文件：

1. **数据源**：从本地文件夹中的 Excel 文件读取数据
2. **自动识别**：自动扫描指定文件夹下的各地区子文件夹
3. **分析维度**：与原脚本完全相同
4. **输出**：生成相同格式的 Word 报告

## 使用方法

### 基本用法

```bash
python generate_local_report.py --folder "output/BunchGlobal_2025_01_18"
```

### 文件夹结构要求

脚本期望的文件夹结构：

```
output/BunchGlobal_2025_01_18/
    united_states/
        jobspy_max_output.xlsx
    united_kingdom/
        jobspy_max_output.xlsx
    australia/
        jobspy_max_output.xlsx
    hong_kong/
        jobspy_max_output.xlsx
    singapore/
        jobspy_max_output.xlsx
```

### 配置选项

可以在脚本顶部修改配置：

```python
# 默认文件夹路径（如果不想每次都用命令行参数）
DEFAULT_FOLDER = "output/BunchGlobal_2025_01_18"

# Excel 文件名（如果文件名不同）
EXCEL_FILENAME = "jobspy_max_output.xlsx"

# 地区名称映射（文件夹名 -> 显示名）
REGION_NAME_MAP = {
    "united_states": "United States",
    "united_kingdom": "United Kingdom",
    # ...
}
```

## 输出说明

### 报告位置

报告保存在：`output/reports/local_job_analysis_report_{文件夹名}_{时间戳}.docx`

### 报告内容

1. **执行摘要**：总体统计信息
2. **各地区详细分析**：
   - 基本统计（总职位数、日期范围）
   - 数据完整性（各字段填充率）
   - 薪资分析（均值、中位数、分位数）
   - 时间范围分析
   - 热门地点
   - 平台分布
3. **跨地区对比**：
   - 数据完整性对比图表
   - 薪资分布对比图表
   - 时间序列图表
   - 平台分布图表
   - 综合对比图表
   - 统计对比表格

## 示例

### 分析 BunchGlobal_2025_01_18 文件夹

```bash
python generate_local_report.py --folder "output/BunchGlobal_2025_01_18"
```

### 分析 BunchIndeedGlobal_2025_12_20 文件夹

```bash
python generate_local_report.py --folder "output/BunchIndeedGlobal_2025_12_20"
```

## 注意事项

1. **Excel 文件格式**：确保 Excel 文件包含以下列：
   - Job Title
   - Company Name
   - Requirements
   - Location
   - Salary Range
   - Estimated Annual Salary
   - Estimated Annual Salary (USD)
   - Job Description
   - Team Size/Business Line Size
   - Company Size
   - Posted Date
   - Job Status
   - Platform
   - Job Link

2. **文件夹结构**：每个地区必须是一个独立的子文件夹，且包含 `jobspy_max_output.xlsx` 文件

3. **缺失数据**：如果某个地区文件夹不存在或 Excel 文件缺失，脚本会跳过并继续处理其他地区

4. **报告生成时间**：根据数据量大小，报告生成可能需要几分钟时间

## 与原脚本的对比

| 特性 | generate_supabase_report.py | generate_local_report.py |
|------|---------------------------|-------------------------|
| 数据源 | Supabase 数据库 | 本地 Excel 文件 |
| 数据过滤 | 支持按创建日期过滤 | 不支持（分析所有数据） |
| 配置方式 | 配置文件 + 命令行参数 | 脚本配置 + 命令行参数 |
| 分析功能 | 完整 | 完整 |
| 报告格式 | Word 文档 | Word 文档 |
| 图表生成 | 支持 | 支持 |

## 故障排除

### 错误：Folder does not exist
- 检查文件夹路径是否正确
- 使用绝对路径或相对路径

### 错误：No subdirectories found
- 确保文件夹下有地区子文件夹
- 检查文件夹结构是否符合要求

### 警告：Excel file not found
- 检查子文件夹中是否有 `jobspy_max_output.xlsx` 文件
- 如果文件名不同，修改 `EXCEL_FILENAME` 配置

### 报告为空
- 检查 Excel 文件是否包含数据
- 检查列名是否正确

